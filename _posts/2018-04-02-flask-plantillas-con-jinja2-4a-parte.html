---
layout: post
status: publish
published: true
title: 'flask: Plantillas con jinja2 (4&ordf; parte)'
author:
  display_name: admin
  login: admin
  email: josedom24@gmail.com
  url: ''
author_login: admin
author_email: josedom24@gmail.com
wordpress_id: 1962
wordpress_url: https://www.josedomingo.org/pledin/?p=1962
date: '2018-04-02 13:07:57 +0000'
date_gmt: '2018-04-02 11:07:57 +0000'
categories:
- General
tags:
- Web
- Python
- Flask
comments: []
---
<p><a class="thumbnail" href="https://www.josedomingo.org/pledin/wp-content/uploads/2018/03/flask.png"><img src="https://www.josedomingo.org/pledin/wp-content/uploads/2018/03/flask.png" alt="" width="460" height="180" class="aligncenter size-full wp-image-1919" /></a></p>
<h1>Plantillas con jinja2</h1>
<p><a href="http://jinja.pocoo.org">Jinja2</a> es un motor de plantilla desarrollado en Python. Flask utiliza jinja2 para generar documentos HTML v&aacute;lidos de una manera muy sencilla y eficiente.</p>
<p>Por dependencias al instalar Flask instalamos jinja2. En esta unidad vamos a estudiar los elementos principales de jinja2, para m&aacute;s informaci&oacute;n accede a la <a href="http://jinja.pocoo.org/docs">documentaci&oacute;n oficial de jinja2</a>.</p>
<h2>Una plantilla simple</h2>
<p>Veamos un ejemplo para entender como funciona jinja2:</p>
<pre><code>from jinja2 import Template

temp1="Hola {{nombre}}"
print(Template(temp1).render(nombre="Pepe"))
</code></pre>
<p>La salida es <code>Hola Pepe</code>. La plantilla se compone de una variable <code>{{nombre}}</code> que es sustituida por el valor de la variable <code>nombre</code> al renderizar o generar la plantilla.</p>
<h2>Elementos de una plantilla</h2>
<p>Una plantilla puede estar formada por texto, y algunos de los siguientes elementos:</p>
<ul>
<li>Variables, se indican con <code>{{ ... }}</code></li>
{% raw  %}
<li>Instrucciones, se indican con <code>{% ... %}</code></li>
{% endraw  %}
<li>Comentarios, se indican con <code>{# ... #}</code></li>
</ul>
<p><!--more--></p>
<h2>Variables en las plantillas</h2>
<p>Las variables en la plantillas se sustituyen por los valores que se pasan a la plantilla al renderizarlas. Si enviamos una lista o un diccionario puedo acceder los valores de dos maneras:</p>
<pre><code>{{ foo.bar }}
{{ foo['bar'] }}
</code></pre>
<p>Veamos algunos ejemplos:</p>
<pre><code>temp2='<a href="{{ url }}"> {{ enlace }}</a>'
print(Template(temp2).render(url="http://www.flask.com",enlace="Flask"))    

temp3='<a href="{{ datos[0] }}"> {{ datos[1] }}</a>'
print(Template(temp3).render(datos=["http://www.flask.com","Flask"]))   

temp4='<a href="{{ datos.url }}"> {{ datos.enlace }}</a>'
print(Template(temp4).render(datos={"url":"http://www.flask.com","enlace":"Flask"}))
</code></pre>
<p>El resultado de las tres plantillas es:</p>
<pre><code><a href="http://www.flask.com"> Flask</a>
</code></pre>
<h2>Filtros de variables</h2>
<p>Un filtro me permite modificar una variable. Son distintas funciones que me modifican o calculan valores a partir de las variables, se indican separadas de las variables por <code>|</code> y si tienen par&aacute;metros se indican entre par&eacute;ntesis. Veamos algunos ejemplos:</p>
<pre><code>temp5='Hola {{nombre|striptags|title}}'
print(Template(temp5).render(nombre="   pepe  "))   

temp6="los datos son {{ lista|join(', ') }}"
print(Template(temp6).render(lista=["amarillo","verde","rojo"]))    

temp6="El ultimo elemento tiene {{ lista|last|length}} caracteres"
print(Template(temp6).render(lista=["amarillo","verde","rojo"]))
</code></pre>
<p>Por defecto los caracteres (<code>></code>, <code><</code>, <code>&amp;</code>, <code>"</code>) no se escapan, si queremos mostrarlo en nuestra p&aacute;gina HTML tenemos que escapar los caracteres:</p>
<pre><code>temp7="La siguiente cadena muestra todos los caracteres: {{ info|e }}"
print(Template(temp7).render(info="<hola&amp;que&amp;tal>"))
</code></pre>
<p>Y por tanto la salida es:</p>
<pre><code>La siguiente cadena muestra todos los caracteres: &amp;lt;hola&amp;amp;que&amp;amp;tal&amp;gt;
</code></pre>
<p>Para ver todos los filtros accede a la <a href="http://jinja.pocoo.org/docs/2.9/templates/#builtin-filters">lista de filtros</a> en la documentaci&oacute;n.</p>
<h2>Instrucciones en las plantillas</h2>
<h3>for</h3>
<p>Nos permite recorrer una secuencia, veamos un ejemplo sencillo. Es compatible con la sentencia <code>for</code> de python.</p>
<pre><code>temp7='''
<ul>
{% for elem in elems -%}
<li>{{loop.index}} - {{ elem }}</li>
{% endfor -%}
</ul>
'''
print(Template(temp7).render(elems=["amarillo","verde","rojo"]))
</code></pre>
<p>La salida es:</p>
<pre><code><ul>
<li>1 - amarillo</li>
<li>2 - verde</li>
<li>3 - rojo</li>
</ul>
</code></pre>
<p>El <code>-</code> detr&aacute;s del bloque <code>for</code> evita que se a&ntilde;ada una l&iacute;nea en blanco.</p>
<p>En un bloque <code>for</code> tenemos acceso a varias variables, veamos las m&aacute;s interesantes:</p>
<ul>
<li><code>loop.index</code>: La iteraci&oacute;n actual del bucle (empieza a contar desde 1).</li>
<li><code>loop.index0</code>: La iteraci&oacute;n actual del bucle (empieza a contar desde 0).</li>
<li><code>loop.first</code>: True si estamos en la primera iteraci&oacute;n.</li>
<li><code>loop.last</code>: True si estamos en la &uacute;ltima iteraci&oacute;n.</li>
<li><code>loop.length</code>: N&uacute;mero de iteraciones del bucle.</li>
</ul>
<h3>if</h3>
<p>Nos permite preguntar por el valor de una variable o si una variable existe. Es compatible con la sentencia <code>if</code> de python.</p>
<p>Ejemplo:</p>
<pre><code>temp9='''
{% if elems %}
<ul>
{% for elem in elems -%}
    {% if elem is divisibleby 2 -%}
        <li>{{elem}} es divisible por 2.</li>
    {% else -%}
        <li>{{elem}} no es divisible por 2.</li>
    {% endif -%}
{% endfor -%}
</ul>
{% endif %}
'''
print(Template(temp9).render(elems=[1,2,3,4]))
</code></pre>
<p>Y la salida ser&aacute;:</p>
<pre><code><ul>
    <li>1 no es divisible por 2.</li>
    <li>2 es divisible por 2.</li>
    <li>3 no es divisible por 2.</li>
    <li>4 es divisible por 2.</li>
</ul>
</code></pre>
<p>Tenemos un conjunto de tests para realizar comprobaciones, por ejemplo <code>divisibleby</code> devuelve True si un n&uacute;mero es divible por el que indiquemos. Hay m&aacute;s tests que podemos utilizar. Para ver todos los tests accede a la <a href="http://jinja.pocoo.org/docs/2.9/templates/#builtin-tests">lista de tests</a> en la documentaci&oacute;n.</p>
<h1>Generando p&aacute;ginas HTML con Flask y Jinja2</h1>
<p>Flask utiliza por defecto jinja2 para generar documentos HTML, para generar una plantilla utilizamos la funci&oacute;n <code>render_template</code> que recibe como par&aacute;metro el fichero donde guardamos la plantilla y las variables que se pasan a esta.</p>
<p>Las plantillas las vamos a guardar en ficheros en el directorio <code>templates</code> (dentro del directorio <code>aplicacion</code>).</p>
<h2>Plantilla simple</h2>
<p>Veamos un ejemplo de c&oacute;mo podemos generar HTML a partir de una plantilla en Flask, el programa ser&aacute; el siguiente:</p>
<pre><code>...
@app.route('/hola/')
@app.route('/hola/<nombre>')
def saluda(nombre=None):
    return render_template("template1.html",nombre=nombre)
</code></pre>
<p>La plantilla:</p>
<pre><code><!DOCTYPE html>
<html lang="es">
<head>
<title>Hola, que tal {{nombre}}</title>
<meta charset="utf-8" />
</head>

<body>
    <header>
       <h1>Mi sitio web</h1>
       <p>Mi sitio web creado en html5</p>
    </header>
    <h2>Vamos a saludar</h2>
    {% if nombre %}
      <h1>Hola {{nombre|title}}</h1>
      <p>&iquest;C&oacute;mo est&aacute;s?</p>
    {%else%}
      <p>No has indicado un nombre</p>
    {% endif %}
</body>
</html>
</code></pre>
<p>Y la salida:</p>
<p><a class="thumbnail" href="https://www.josedomingo.org/pledin/wp-content/uploads/2018/03/template1.png"><img src="https://www.josedomingo.org/pledin/wp-content/uploads/2018/03/template1.png" alt="" width="264" height="340" class="aligncenter size-full wp-image-1963" /></a></p>
<h2>Env&iacute;o de varias variables a una plantilla</h2>
<p>En este caso veremos un ejemplo donde mandamos varias variables a la plantilla:</p>
<pre><code>@app.route('/suma/<num1>/<num2>')
def suma(num1,num2):
    try:
        resultado=int(num1)+int(num2)
    except:
        abort(404)
    return render_template("template2.html",num1=num1,num2=num2,resultado=resultado)
</code></pre>
<p>La plantilla:</p>
<pre><code>...
    <h2>Suma</h2>
    {% if resultado>0 %}
      <p>El resultado es positivo</p>
    {%else%}
      <p>El resultado es negativo</p>
    {% endif %}
    <h3>{{resultado}}</h3>
...
</code></pre>
<p>Y la salida:</p>
<p><a class="thumbnail" href="https://www.josedomingo.org/pledin/wp-content/uploads/2018/03/template2.png"><img src="https://www.josedomingo.org/pledin/wp-content/uploads/2018/03/template2.png" alt="" width="283" height="323" class="aligncenter size-full wp-image-1964" /></a></p>
<h2>Generando p&aacute;ginas de error con plantillas</h2>
<p>Como vemos en el ejemplo anterior, si los n&uacute;meros no se pueden sumar se generara una respuesta 404, podemos tambi&eacute;n generar esta p&aacute;gina a partir de una plantilla:</p>
<pre><code>@app.errorhandler(404)
def page_not_found(error):
    return render_template("error.html",error="P&aacute;gina no encontrada..."), 404
</code></pre>
<p>La plantilla:</p>
<pre><code>...
    <header>
       <h1>{{error}}</h1>
       <img src="{{ url_for('static', filename='img/tux.png')}}"/>
    </header>   
...
</code></pre>
<h2>Uso de for en una plantilla</h2>
<p>En este caso vamos a mostrar la tabla de multiplicar de un n&uacute;mero, en la plantilla vamos a generar un bucle con 10 iteraciones usando el tipo de datos <code>range</code>:</p>
<pre><code>@app.route('/tabla/<numero>')
def tabla(numero):
    try:
        numero=int(numero)
    except:
        abort(404)
    return render_template("template3.html",num=numero)
</code></pre>
<p>La plantilla:</p>
<pre><code>...
    <h2>Tabla de multiplicar</h2>
    {% for i in range(1,11) -%}
      <p>{{num}} * {{i}} = {{num*i}}</p>
    {% endfor -%}
...
</code></pre>
<p>Y la salida:</p>
<p><a class="thumbnail" href="https://www.josedomingo.org/pledin/wp-content/uploads/2018/03/template3.png"><img src="https://www.josedomingo.org/pledin/wp-content/uploads/2018/03/template3.png" alt="" width="266" height="605" class="aligncenter size-full wp-image-1965" /></a></p>
<h2>Env&iacute;o de diccionario a una plantilla</h2>
<p>En realidad vamos a mandar una lista de diccionarios, donde tenemos informaci&oacute;n para construir un enlace:</p>
<pre><code>@app.route('/enlaces')
def enlaces():
    enlaces=[{"url":"http://www.google.es","texto":"Google"},
            {"url":"http://www.twitter.com","texto":"Twitter"},
            {"url":"http://www.facbook.com","texto":"Facebook"},
            ]
    return render_template("template4.html",enlaces=enlaces)
</code></pre>
<p>La plantilla:</p>
<pre><code>...
    <h2>Enlaces</h2>
    {% if enlaces %}
    <ul>
    {% for enlace in enlaces -%}
      <li><a href="{{ enlace.url }}">{{ enlace.texto }}</a></li>
    {% endfor -%}
    </ul>
    {% else %}
        <p>No hay enlaces></p>
    {% endif %}
...
</code></pre>
<p>Y la salida:</p>
<p><a class="thumbnail" href="https://www.josedomingo.org/pledin/wp-content/uploads/2018/03/template4.png"><img src="https://www.josedomingo.org/pledin/wp-content/uploads/2018/03/template4.png" alt="" width="261" height="318" class="aligncenter size-full wp-image-1966" /></a></p>
<h1>Herencia de plantillas</h1>
<p>La herencia de plantillas nos permite hacer un esqueleto de plantilla, para que todas las p&aacute;ginas de nuestro sitio web sean similares. En la unidad anterior hicimos una plantilla independiente para cada p&aacute;gina, eso tiene un problema: si queremos cambiar algo que es com&uacute;n a todas las p&aacute;ginas hay que cambiarlo en todos los ficheros.</p>
<p>En nuestro caso vamos a crear una plantilla base de donde se van a heredar todas las dem&aacute;s, e indicaremos los bloques que las plantillas hijas pueden sobreescribir.</p>
<h2>La plantilla base</h2>
<p>Vamos a crear una plantilla <code>base.html</code> donde indicaremos las partes comunes de todas nuestras p&aacute;ginas, e indicaremos los bloques que las otras plantillas pueden reescribir.</p>
<pre><code><!DOCTYPE html>
<html lang="es">
<head>
{% raw  %}
<title>{% block title %}{% endblock %}</title>
{% endraw  %}
<link rel="stylesheet" href="{{url_for("static", filename='css/style.css')}}">
<meta charset="utf-8" />
</head>

<body>
    <header>
       <h1>Mi sitio web</h1>
       <p>Mi sitio web creado en html5</p>
    </header>
{% raw  %}
    {% block content %}{% endblock %}
{% endraw  %}
</body>
</html>
</code></pre>
<p>Algunas consideraciones:</p>
<ol>
<li>Hemos creado dos bloques (<code>title</code> y <code>content</code>) en las plantillas hijas vamos a poder rescribir esos dos bloque para poner el t&iacute;tulo de la p&aacute;gina y el contenido. Podr&iacute;amos indicar todos los bloques que necesitamos.</li>
<li>Hemos incluido una hoja de estilo que est&aacute; en nuestro contenido est&aacute;tico (directorio <code>static</code>)</li>
</ol>
<h2>Herencia de plantillas</h2>
<p>A continuaci&oacute;n, veamos la primera plantilla (<code>tample1.html</code>) utilizando la t&eacute;cnica de herencia:</p>
{% raw  %}
<pre><code>{% extends "base.html" %}
{% block title %}Hola, que tal {{nombre}}{% endblock %}
{% block content %}
    <h2>Vamos a saludar</h2>
    {% if nombre %}
      <h1>Hola {{nombre|title}}</h1>
      <p>&iquest;C&oacute;mo est&aacute;s?</p>
    {%else%}
      <p>No has indicado un nombre</p>
    {% endif %}
{% endblock %}
{% endraw  %}
</code></pre>
<p>Observamos c&oacute;mo hemos reescrito los dos bloques.</p>
<p>Ejecuta el programa y comprueba que se genera el documento HTML completo, comprueba tambi&eacute;n que se est&aacute; usando una hoja de estilo.</p>
